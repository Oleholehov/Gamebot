import telebot
from telebot import types
import threading
import time
import random

TOKEN = '8000562573:AAFqDqdnhr84hRcxl_wz-3sUpx3EmW0cdA8'
bot = telebot.TeleBot(TOKEN)

# Список з 100 фраз
phrases = [
    "За 10 секунд назви 5 марок автомобілів",
    "За 10 секунд назви 5 країн Європи",
    "За 10 секунд назви 5 тварин Африки",
    "За 10 секунд назви 5 перших страв",
    "За 10 секунд назви 5 видів транспорту",
    "За 10 секунд назви 5 голівудських зірок",
    "За 10 секунд назви 5 кольорів веселки",
    "За 10 секунд назви 5 видів фруктів",
    "За 10 секунд назви 5 популярних соціальних мереж",
    "За 10 секунд назви 5 музичних інструментів",
    "За 10 секунд назви 5 марок смартфонів",
    "За 10 секунд назви 5 видів квітів",
    "За 10 секунд назви 5 видів спорту",
    "Штраф -1 бали",
    "За 10 секунд назви 5 мов програмування",
    "За 10 секунд назви 5 казкових персонажів",
    "За 10 секунд назви 5 столиць світу",
    "За 10 секунд назви 5 тварин, що живуть в океані",
    "За 10 секунд назви 5 видів сирів",
    "За 10 секунд назви 5 планет Сонячної системи",
    "За 10 секунд назви 5 відомих письменників",
    "За 10 секунд назви 5 популярних фільмів",
    "За 10 секунд назви 5 видів дерев",
    "За 10 секунд назви 5 типів морозива",
    "За 10 секунд назви 5 знаменитих художників",
    "За 10 секунд назви 5 видів комах",
    "За 10 секунд назви 5 країн Азії",
    "За 10 секунд назви 5 марок годинників",
    "За 10 секунд назви 5 відомих міст США",
    "За 10 секунд назви 5 видів кави",
    "За 10 секунд назви 5 популярних соцмереж",
    "За 10 секунд назви 5 видів риб",
    "За 10 секунд назви 5 квітів весни",
    "За 10 секунд назви 5 видів спортивного інвентарю",
    "За 10 секунд назви 5 найбільших озер світу",
    "За 10 секунд назви 5 країн Південної Америки",
    "За 10 секунд назви 5 порід собак",
    "За 10 секунд назви 5 видів танців",
    "За 10 секунд назви 5 знаменитих науковців",
    "За 10 секунд назви 5 фільмів про супергероїв",
    "За 10 секунд назви 5 видів птахів",
    "За 10 секунд назви 5 видів десертів",
    "За 10 секунд назви 5 відомих музеїв світу",
    "Штраф -2 бали",
    "За 10 секунд назви 5 видів зброї",
    "За 10 секунд назви 5 музичних жанрів",
    "За 10 секунд назви 5 відомих рекордів Гіннеса",
    "За 10 секунд назви 5 видів спорту на воді",
    "За 10 секунд назви 5 найбільших пустель світу",
    "За 10 секунд назви 5 видів домашніх тварин",
    "За 10 секунд назви 5 відомих композиторів",
    "За 10 секунд назви 5 типів будівель",
    "За 10 секунд назви 5 популярних відеоігор",
    "За 10 секунд назви 5 видів хмар",
    "За 10 секунд назви 5 найбільших річок світу",
    "За 10 секунд назви 5 видів морепродуктів",
    "За 10 секунд назви 5 видів кухонного посуду",
    "За 10 секунд назви 5 марок шоколаду",
    "За 10 секунд назви 5 видів спорту на льоду",
    "За 10 секунд назви 5 кольорів улюблених футболок",
    "За 10 секунд назви 5 видів техніки",
    "За 10 секунд назви 5 відомих поетів",
    "За 10 секунд назви 5 видів танцівальних стилів",
    "За 10 секунд назви 5 типів транспортних засобів",
    "За 10 секунд назви 5 відомих брендів одягу",
    "За 10 секунд назви 5 видів деревини",
    "За 10 секунд назви 5 жанрів кіно",
    "За 10 секунд назви 5 популярних телешоу",
    "Вам нараховано бонус 2 бали",
    "За 10 секунд назви 5 типів кімнатних рослин",
    "За 10 секунд назви 5 найбільших островів світу",
    "За 10 секунд назви 5 видів морозива",
    "За 10 секунд назви 5 відомих політиків",
    "За 10 секунд назви 5 видів зернових культур",
    "За 10 секунд назви 5 марок автомобілів преміум-класу",
    "За 10 секунд назви 5 відомих футболістів",
    "За 10 секунд назви 5 видів кавових напоїв",
    "За 10 секунд назви 5 популярних книг",
    "За 10 секунд назви 5 видів музичних інструментів",
    "Вам нараховано бонус 3 бали",
    "За 10 секунд назви 5 країн Африки",
    "За 10 секунд назви 5 популярних мобільних додатків",
    "За 10 секунд назви 5 видів печива",
    "За 10 секунд назви 5 тварин, що живуть у лісі",
    "За 10 секунд назви 5 відомих акторів",
    "За 10 секунд назви 5 видів спорту для дітей",
    "За 10 секунд назви 5 популярних автомобільних брендів",
    "За 10 секунд назви 5 видів орхідей",
    "За 10 секунд назви 5 видів музичних груп",
    "За 10 секунд назви 5 типів взуття",
    "За 10 секунд назви 5 відомих міфологічних істот",
    "За 10 секунд назви 5 видів ювелірних каменів",
    "За 10 секунд назви 5 популярних кав’ярень",
    "За 10 секунд назви 5 видів спорту на відкритому повітрі",
    "За 10 секунд назви 5 знаменитих будівель",
    "За 10 секунд назви 5 видів морозива",
    "За 10 секунд назви 5 відомих письменниць",
    "За 10 секунд назви 5 типів кавових зерен",
    "За 10 секунд назви 5 видів диких тварин",
    "За 10 секунд назви 5 видів дитячих іграшок",
    "За 10 секунд назви 5 марок спортивного одягу",
    "За 10 секунд назви 5 видів вітамінів",
    "За 10 секунд назви 5 типів кухонної техніки",
    "За 10 секунд назви 5 відомих міст Азії",
    "За 10 секунд назви 5 популярних настільних ігор",
]

user_games = {}  # зберігаємо стан гри для кожного користувача

def create_keyboard():
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.row("Старт", "Старт (таймер)")
    keyboard.row("Нова гра")
    return keyboard

@bot.message_handler(commands=["start"])
def send_welcome(message):
    user_games[message.chat.id] = {"used": [], "timer": False}
    bot.send_message(message.chat.id,
                     "Привіт! Натисни 'Старт' щоб отримати фразу.\n"
                     "Потім можеш натиснути 'Старт (таймер)', щоб почати 10-секундний відлік.\n"
                     "Або 'Нова гра' щоб почати спочатку.",
                     reply_markup=create_keyboard())

@bot.message_handler(func=lambda m: True)
def handle_game(message):
    user_id = message.chat.id
    text = message.text.strip()

    # Ініціалізуємо гру, якщо немає
    if user_id not in user_games:
        user_games[user_id] = {"used": [], "timer": False}

    game = user_games[user_id]

    if text == "Нова гра":
        game["used"] = []
        game["timer"] = False
        bot.send_message(user_id, "Гра скинута. Натисни 'Старт' щоб почати знову.")
        return

    if text == "Старт":
        if len(game["used"]) == len(phrases):
            bot.send_message(user_id, "Всі фрази використані! Натисни 'Нова гра' для початку заново.")
            return

        available_phrases = [p for p in phrases if p not in game["used"]]
        phrase = random.choice(available_phrases)
        game["used"].append(phrase)
        game["timer"] = False
        bot.send_message(user_id, f"Твоя фраза:\n\n{phrase}")
        return

    if text == "Старт (таймер)":
        if not game["used"]:
            bot.send_message(user_id, "Спочатку натисни 'Старт', щоб отримати фразу.")
            return
        if game["timer"]:
            bot.send_message(user_id, "Таймер вже запущений!")
            return

        game["timer"] = True
        bot.send_message(user_id, "Таймер запущено! У тебе є 10 секунд на відповідь.")
        
        def timer_thread(chat_id):
            time.sleep(8)
            if user_games.get(chat_id, {}).get("timer", False):
                bot.send_message(chat_id, "Час вичерпано! Натисни 'Старт' для наступної фрази або 'Нова гра' щоб почати спочатку.")
                user_games[chat_id]["timer"] = False

        threading.Thread(target=timer_thread, args=(user_id,)).start()
        return

    # Якщо надіслано щось інше
    bot.send_message(user_id, "Натисни 'Старт' щоб отримати фразу, 'Старт (таймер)' щоб почати відлік, або 'Нова гра' для скидання.")

bot.polling(none_stop=True)