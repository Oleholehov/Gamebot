import telebot
from telebot import types
import random
import threading
import os
from flask import Flask, request

TOKEN = "8000562573:AAFqDqdnhr84hRcxl_wz-3sUpx3EmW0cdA8"
bot = telebot.TeleBot(TOKEN)
WEBHOOK_URL = "https://gamebot-1234.onrender.com"

questions = [
    "–ù–∞–∑–≤–∏ 5 –º–∞—Ä–æ–∫ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 –∫—Ä–∞—ó–Ω –Ñ–≤—Ä–æ–ø–∏",
    "–ù–∞–∑–≤–∏ 5 —Ç–≤–∞—Ä–∏–Ω –ê—Ñ—Ä–∏–∫–∏",
    "–ù–∞–∑–≤–∏ 5 –ø–µ—Ä—à–∏—Ö —Å—Ç—Ä–∞–≤",
    "–ù–∞–∑–≤–∏ 5 –≤–∏–¥—ñ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É",
    "–ù–∞–∑–≤–∏ 5 –≥–æ–ª–ª—ñ–≤—É–¥—Å—å–∫–∏—Ö –∑—ñ—Ä–æ–∫",
    "–ù–∞–∑–≤–∏ 5 —Ä—ñ—á–æ–∫ –£–∫—Ä–∞—ó–Ω–∏",
    "–ù–∞–∑–≤–∏ 5 –∫–æ–ª—å–æ—Ä—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 —Ñ—Ä—É–∫—Ç—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 –æ–≤–æ—á—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 –º—ñ—Å—Ç –£–∫—Ä–∞—ó–Ω–∏",
    "–ù–∞–∑–≤–∏ 5 –≤–∏–¥—ñ–≤ —Å–ø–æ—Ä—Ç—É",
    "–ù–∞–∑–≤–∏ 5 –æ–∫–µ–∞–Ω—ñ–≤ –∞–±–æ –º–æ—Ä—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 –∫—Ä–∞—ó–Ω –ê–∑—ñ—ó",
    "–ù–∞–∑–≤–∏ 5 –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ —É —à–∫–æ–ª—ñ",
    "–ù–∞–∑–≤–∏ 5 —Ç–≤–∞—Ä–∏–Ω, —è–∫—ñ –∂–∏–≤—É—Ç—å —É –ª—ñ—Å—ñ",
    "–ù–∞–∑–≤–∏ 5 –º—É–∑–∏—á–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 –∂–∞–Ω—Ä—ñ–≤ —Ñ—ñ–ª—å–º—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 –∫–≤—ñ—Ç—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 –º–æ–≤ —Å–≤—ñ—Ç—É",
    "–ù–∞–∑–≤–∏ 5 –≥—ñ—Ä—Å—å–∫–∏—Ö –≤–µ—Ä—à–∏–Ω",
    "–ù–∞–∑–≤–∏ 5 —Å–≤—è—Ç",
    "–ù–∞–∑–≤–∏ 5 –≤–∏–¥—ñ–≤ –æ–¥—è–≥—É",
    "–ù–∞–∑–≤–∏ 5 –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–Ω–∏—Ö —ñ–≥–æ—Ä",
    "–ù–∞–∑–≤–∏ 5 –º—É–ª—å—Ç—Ñ—ñ–ª—å–º—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 –≤–∏–¥—ñ–≤ —á–∞—é",
    "–ù–∞–∑–≤–∏ 5 –ø–ª–∞–Ω–µ—Ç",
    "–ù–∞–∑–≤–∏ 5 –ø–æ—Ä —Ä–æ–∫—É",
    "–ù–∞–∑–≤–∏ 5 —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏—Ö –ø—ñ—Å–µ–Ω—å",
    "–ù–∞–∑–≤–∏ 5 –ø–∏—Å—å–º–µ–Ω–Ω–∏–∫—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 —Ñ—ñ–ª—å–º—ñ–≤ –ø—Ä–æ —Å—É–ø–µ—Ä–≥–µ—Ä–æ—ó–≤",
    "–ù–∞–∑–≤–∏ 5 —Ç–≤–∞—Ä–∏–Ω –∑ —Ñ–µ—Ä–º–∏",
    "–ù–∞–∑–≤–∏ 5 —Ç–∏–ø—ñ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É",
    "–ù–∞–∑–≤–∏ 5 —Å–º–∞—Ä—Ç—Ñ–æ–Ω—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 –≤–∏–¥—ñ–≤ —Å–ø–æ—Ä—è–¥–∂–µ–Ω–Ω—è –¥–ª—è –∫–µ–º–ø—ñ–Ω–≥—É",
    "–ù–∞–∑–≤–∏ 5 —Ö–æ–±—ñ",
    "–ù–∞–∑–≤–∏ 5 —Å–ø–æ—Å–æ–±—ñ–≤ –ø–µ—Ä–µ—Å—É–≤–∞–Ω–Ω—è",
    "–ù–∞–∑–≤–∏ 5 –ø–∞—Ä–Ω–∏—Ö –ø—Ä–µ–¥–º–µ—Ç—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 –µ–º–æ—Ü—ñ–π",
    "–ù–∞–∑–≤–∏ 5 –∫–Ω–∏–≥",
    "–ù–∞–∑–≤–∏ 5 –º—ñ—Å—Ç –≤ –ê–º–µ—Ä–∏—Ü—ñ",
    "–ù–∞–∑–≤–∏ 5 –Ω–∞–ø–æ—ó–≤",
    "–ù–∞–∑–≤–∏ 5 –≤–∏–¥—ñ–≤ –º‚Äô—è—Å–∞",
    "–ù–∞–∑–≤–∏ 5 –ø—Ç–∞—Ö—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 —Å—Å–∞–≤—Ü—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 —Ä–∏–±",
    "–ù–∞–∑–≤–∏ 5 –∫–∞–∑–∫–æ–≤–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 —Å—Ç—Ä–∞–≤ –∑ –∫–∞—Ä—Ç–æ–ø–ª—ñ",
    "–ù–∞–∑–≤–∏ 5 –≤–∏–¥—ñ–≤ —Å–∏—Ä—É",
    "–ù–∞–∑–≤–∏ 5 –º–∞—Ä–æ–∫ –æ–¥—è–≥—É",
    "–ù–∞–∑–≤–∏ 5 —Å–æ–ª–æ–¥–æ—â—ñ–≤",
    "–ù–∞–∑–≤–∏ 5 —Ñ—ñ–ª—å–º—ñ–≤ Disney",
    "–ù–∞–∑–≤–∏ 5 –º–æ–≤ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è",
    "–ù–∞–∑–≤–∏ 5 –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç–µ–π –∑ YouTube",
    "–ù–∞–∑–≤–∏ 5 —Å–ø–æ—Ä—Ç–∏–≤–Ω–∏—Ö –∫–æ–º–∞–Ω–¥",
    "–ù–∞–∑–≤–∏ 5 –Ω–∞—Å—Ç—ñ–ª—å–Ω–∏—Ö —ñ–≥–æ—Ä",
    "–ù–∞–∑–≤–∏ 5 –∫—Ä–∞—ó–Ω –ê—Ñ—Ä–∏–∫–∏",
    "–ù–∞–∑–≤–∏ 5 —Ñ—ñ–ª—å–º—ñ–≤ –ø—Ä–æ –ª—é–±–æ–≤",
    "–ù–∞–∑–≤–∏ 5 –ø—Ä–æ—Ñ–µ—Å—ñ–π"
]

active_questions = {}

@bot.message_handler(commands=['start'])
def start_game(message):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add(types.KeyboardButton("–ù–æ–≤–∞ –≥—Ä–∞"))
    bot.send_message(message.chat.id, "–ü—Ä–∏–≤—ñ—Ç! –ù–∞—Ç–∏—Å–Ω–∏ '–ù–æ–≤–∞ –≥—Ä–∞', —â–æ–± —Ä–æ–∑–ø–æ—á–∞—Ç–∏.", reply_markup=markup)

@bot.message_handler(func=lambda message: message.text == "–ù–æ–≤–∞ –≥—Ä–∞")
def new_game(message):
    chat_id = message.chat.id
    active_questions[chat_id] = questions.copy()
    send_question(message)

def send_question(message):
    chat_id = message.chat.id
    if chat_id not in active_questions or not active_questions[chat_id]:
        bot.send_message(chat_id, "–ì—Ä—É –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ù–∞—Ç–∏—Å–Ω–∏ '–ù–æ–≤–∞ –≥—Ä–∞', —â–æ–± –ø–æ—á–∞—Ç–∏ —Å–ø–æ—á–∞—Ç–∫—É.")
        return

    question = random.choice(active_questions[chat_id])
    active_questions[chat_id].remove(question)
    bot.send_message(chat_id, f"üéØ –ó–∞–≤–¥–∞–Ω–Ω—è:\n{question}\n‚è± –£ —Ç–µ–±–µ —î 10 —Å–µ–∫—É–Ω–¥!")
    threading.Timer(8.0, lambda: bot.send_message(chat_id, "‚åõ –ß–∞—Å –≤–∏–π—à–æ–≤! –ù–∞—Ç–∏—Å–Ω–∏ '–ù–æ–≤–∞ –≥—Ä–∞' –∞–±–æ —á–µ–∫–∞–π –Ω–∞—Å—Ç—É–ø–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è.")).start()

app = Flask(__name__)

@app.route('/bot', methods=['POST'])
def webhook():
    bot.process_new_updates([telebot.types.Update.de_json(request.stream.read().decode("utf-8"))])
    return '', 200

@app.route('/', methods=['GET'])
def index():
    return '–ë–æ—Ç –ø—Ä–∞—Ü—é—î!'

def start_webhook():
    bot.remove_webhook()
    bot.set_webhook(url=f"{WEBHOOK_URL}/bot")
    app.run(host="0.0.0.0", port=int(os.environ.get("PORT", 5000)))

if __name__ == "__main__":
    start_webhook()
